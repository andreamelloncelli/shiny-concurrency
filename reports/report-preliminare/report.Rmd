---
title: "Load Test Results"
output: 
  html_document:
    df_print: paged
params: 
  directory:
    label: "Directory with profiles from load test"
    value: !r getwd()
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE)
library(shinyloadtest)
library(ggplot2)
```


```{r runTest, warning = FALSE}
log <- createLog(params$directory)
```


## Results

Il test è partito alle `r min(log$time)` ed è terminato alle `r max(log$time)`. 

Connessioni effettuate con successo: `r length(unique(log$connection))`. 

Massiomo di sessioni concorrenti `r getMaxConcurrent(log)` raggiunte.

Questo plot presenta il numero di sessioni attive al variare del tempo del test:

```{r concurrent_over_time}
con <- getConcurrentOverTest(log)
ggplot(con, aes(time, connections)) +
         geom_point() +
         geom_smooth() +
         theme_bw() +
         labs(
           title = "Concurrent connections over time"
         )

```

## Page load time

Questo boxplot presenta la distribuzione dei tempi di caricamento della pagina dopo l'apertura del browser all'indirizzo dell'applicazione. NB: la sensibilità della misurazione del tempo è in secondi interi.

```{r}
  
load <- getPageLoadTimes(log) 

binwidth = max(1, diff(range(load$load_time_sec))/40)

ggplot(load, aes(load_time_sec)) + 
  geom_histogram(mapping = aes(y = ..count..), binwidth = binwidth, alpha = .9, fill = "blue", color = "black") +
  theme_minimal() +
  scale_x_continuous() +
  labs(
    title = "Page Load Time",
    y = "Count",
    x = "Load Time (sec)"
  ) 
```

Tempo medio di caricamento: `r mean(load$load_time_sec)` secondi.

Questo plot invece presenta le distribuzioni dei tempi di risposta per ognuno dei tre click (interazione utente).
NB: la sensibilità della misurazione del tempo è in secondi interi.

```{r}
load <- getSetInputTimes(log)
load$inputId <- as.factor(load$inputId)
ggplot(load, aes(inputId, event_time_sec)) +
  geom_violin()  +
  # geom_jitter() +
  labs(
    title = "Application Usage",
    x = "",
    y = paste0("Event Time (sec)"),
    fill = ""
  ) +
  theme_minimal() + 
  guides(fill = FALSE)
```

